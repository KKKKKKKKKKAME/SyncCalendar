<!DOCTYPE html>
<html>
<head>
  <title>Notion & Google Calendar Sync</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Nunito+Sans:wght@400;500&family=Poppins:wght@700&display=swap" rel="stylesheet">
  <style>
    ถ้าคุณเจอข้อผิดพลาด "❌ Error: Failed to fetch" นั่นแสดงว่า fetch request ไม่สำเร็จ ซึ่งอาจเกิดจากหลายสาเหตุ เช่น CORS ยังไม่ถูกตั้งค่าถูกต้อง, URL ไม่ถูกต้อง, หรือ server ไม่ตอบสนอง ผมจะช่วยวิเคราะห์และแก้ไขให้ครับ โดยเราจะเพิ่มการดีบักและปรับปรุงโค้ดให้แข็งแกร่งขึ้น

สาเหตุที่เป็นไปได้และวิธีแก้ไข
CORS ไม่ถูกตั้งค่าถูกต้องใน Google Apps Script
ตรวจสอบว่า Google Apps Script Web App ส่ง header Access-Control-Allow-Origin กลับมาถูกต้องหรือไม่
URL ของ Google Apps Script Web App ไม่ถูกต้อง
ตรวจสอบว่า SCRIPT_URL ใน HTML ถูกต้องและเข้าถึงได้
Google Apps Script Web App ไม่ได้ deploy หรือตั้งค่าไม่ถูกต้อง
ต้อง deploy ใหม่และตั้งค่าให้ "Who has access" เป็น "Anyone"
Network หรือ Server Error
อาจมีปัญหาการเชื่อมต่อหรือ rate limit
ปรับปรุง HTML เพื่อดีบักและจัดการข้อผิดพลาด
ผมจะเพิ่มการ log ข้อมูลเพิ่มเติมใน console และปรับ fetch ให้แสดง error ชัดเจนขึ้น:

html
Wrap
Copy
<!DOCTYPE html>
<html>
<head>
  <title>Notion & Google Calendar Sync</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Nunito+Sans:wght@400;500&family=Poppins:wght@700&display=swap" rel="stylesheet">
  <style>
    /* คงสไตล์เดิมไว้เหมือนในโค้ดก่อนหน้า */
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      background: linear-gradient(90deg, #9ABED9, #E3DEEE);
      background-size: 200% 200%;
      animation: gradientBG 8s ease infinite;
      color: #ffffff;
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow: hidden;
    }
    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .navbar {
      width: 100%;
      background: rgba(255, 255, 255, 0.1);
      padding: 16px 32px;
      box-sizing: border-box;
      text-align: center;
      font-family: 'Nunito Sans', sans-serif;
      font-size: 16px;
      font-weight: 500;
    }
    .navbar a {
      color: #014871;
      text-decoration: none;
      margin: 0 16px;
      transition: color 0.3s ease;
    }
    .navbar a:hover {
      color: #ffffff;
    }
    .content {
      text-align: center;
      width: 100%;
      max-width: 480px;
      padding: 32px;
      box-sizing: border-box;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .title {
      font-family: 'Poppins', sans-serif;
      font-size: 40px;
      font-weight: 700;
      color: #333333;
      margin-bottom: 24px;
      line-height: 1.2;
    }
    .progress {
      width: 200px;
      height: 6px;
      background-color: rgba(255, 255, 255, 0.2);
      border-radius: 3px;
      overflow: hidden;
      margin: 24px auto;
      position: relative;
    }
    .progress-bar {
      height: 100%;
      background: linear-gradient(to right, #9ABED9, #E3DEEE);
      width: 0%;
      transition: width 0.5s ease-in-out;
    }
    .progress-text, #status, .notifications {
      font-family: 'Nunito Sans', sans-serif;
    }
    .progress-text {
      font-size: 16px;
      font-weight: 400;
      color: #f8f8f8;
      margin-top: 12px;
    }
    #status {
      font-size: 20px;
      font-weight: 500;
      color: #014871;
      margin-top: 24px;
    }
    .notifications {
      margin-top: 16px;
      font-size: 16px;
      font-weight: 400;
      color: #f8f8f8;
      text-align: center;
      line-height: 1.5;
    }
    .notifications span {
      font-weight: 500;
      color: #ffffff;
    }
    @media (max-width: 768px) {
      .navbar { padding: 12px 24px; font-size: 14px; }
      .navbar a { margin: 0 8px; }
      .content { max-width: 90%; padding: 24px; }
      .title { font-size: 32px; }
      .progress { width: 150px; }
      #status, .progress-text, .notifications { font-size: 14px; }
    }
  </style>
  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw8URgURQgA5pi8hANXCiAzrPX0-WFMXKj-QuWwzf-5fcH48ACavth6zw9fa-l2GpX2/exec"; // แทนที่ด้วย URL จริง

    async function startSync() {
      const progressBar = document.getElementById("progress-bar");
      const progressText = document.getElementById("progress-text");
      const status = document.getElementById("status");
      const notifications = document.getElementById("notifications");

      progressBar.style.width = "0%";
      progressText.innerText = "0%";
      status.innerText = "Syncing...";

      let progress = 0;
      const interval = setInterval(() => {
        progress += 10;
        if (progress <= 100) {
          progressBar.style.width = progress + "%";
          progressText.innerText = progress + "%";
        }
      }, 200);

      try {
        console.log("Starting fetch to:", SCRIPT_URL);
        const response = await fetch(SCRIPT_URL, {
          method: "POST",
          mode: "cors",
          headers: {
            "Content-Type": "application/json",
            "Accept": "application/json"
          },
          body: JSON.stringify({ action: "syncNotionToGoogleCalendar" })
        });

        console.log("Response status:", response.status);
        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(`HTTP error! status: ${response.status}, details: ${errorText}`);
        }

        const data = await response.json();
        console.log("Response data:", data);

        clearInterval(interval);
        progressBar.style.width = "100%";
        progressText.innerText = "100%";
        status.innerText = "Sync Completed Successfully!";

        const notionEvents = data.notionEvents || 0;
        const calendarEvents = data.calendarEvents || 0;
        const alertEvents = data.alertEvents || 0;

        notifications.innerHTML = `
          <span>Notion events:</span> ${notionEvents}<br>
          <span>Google Calendar events in range:</span> ${calendarEvents}<br>
          <span>Alert:</span> ${alertEvents} events within 5 days of expiring
        `;
      } catch (error) {
        clearInterval(interval);
        status.innerText = `❌ Error: ${error.message}`;
        console.error("Fetch failed:", error);
        notifications.innerHTML = "Please check the console for more details.";
      }
    }

    window.onload = startSync;
  </script>
</head>
<body>
  <div class="navbar">
    <a href="?page=index">Sync</a>
    <a href="?page=areashex">Set Area Color</a>
  </div>
  <div class="content">
    <div class="title">Notion & Calendar Sync</div>
    <div class="progress">
      <div id="progress-bar" class="progress-bar"></div>
    </div>
    <div id="progress-text" class="progress-text">0%</div>
    <div id="status"></div>
    <div id="notifications" class="notifications"></div>
  </div>
</body>
</html>
